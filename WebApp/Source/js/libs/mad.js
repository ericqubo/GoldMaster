/** @license
 * Madjs <>
 * Author: indifer | MIT License
 * Email: indifer@126.com|liangyi_z@126.com
 * v0.9.2 (2014/08/29 00:46)
 */
; !function (t) { function e(t, e, i, n, r) { this._listener = e, this._isOnce = i, this.context = n, this._signal = t, this._priority = r || 0 } function i(t, e) { if ("function" != typeof t) throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}", e)) } function n() { this._bindings = [], this._prevParams = null } e.prototype = { active: !0, params: null, execute: function (t) { var e, i; return this.active && this._listener && (i = this.params ? this.params.concat(t) : t, e = this._listener.apply(this.context, i), this._isOnce && this.detach()), e }, detach: function () { return this.isBound() ? this._signal.remove(this._listener, this.context) : null }, isBound: function () { return !!this._signal && !!this._listener }, getListener: function () { return this._listener }, _destroy: function () { delete this._signal, delete this._listener, delete this.context }, isOnce: function () { return this._isOnce }, toString: function () { return "[SignalBinding isOnce:" + this._isOnce + ", isBound:" + this.isBound() + ", active:" + this.active + "]" } }, n.prototype = { VERSION: "0.8.1", memorize: !1, _shouldPropagate: !0, active: !0, _registerListener: function (t, i, n, r) { var s, o = this._indexOfListener(t, n); if (-1 !== o) { if (s = this._bindings[o], s.isOnce() !== i) throw new Error("You cannot add" + (i ? "" : "Once") + "() then add" + (i ? "Once" : "") + "() the same listener without removing the relationship first.") } else s = new e(this, t, i, n, r), this._addBinding(s); return this.memorize && this._prevParams && s.execute(this._prevParams), s }, _addBinding: function (t) { var e = this._bindings.length; do --e; while (this._bindings[e] && t._priority <= this._bindings[e]._priority); this._bindings.splice(e + 1, 0, t) }, _indexOfListener: function (t, e) { for (var i, n = this._bindings.length; n--;) if (i = this._bindings[n], i._listener === t && i.context === e) return n; return -1 }, has: function (t, e) { return -1 !== this._indexOfListener(t, e) }, add: function (t, e, n) { return i(t, "add"), this._registerListener(t, !1, e, n) }, addOnce: function (t, e, n) { return i(t, "addOnce"), this._registerListener(t, !0, e, n) }, remove: function (t, e) { i(t, "remove"); var n = this._indexOfListener(t, e); return -1 !== n && (this._bindings[n]._destroy(), this._bindings.splice(n, 1)), t }, removeAll: function () { for (var t = this._bindings.length; t--;) this._bindings[t]._destroy(); this._bindings.length = 0 }, getNumListeners: function () { return this._bindings.length }, halt: function () { this._shouldPropagate = !1 }, dispatch: function () { if (this.active) { var t, e = Array.prototype.slice.call(arguments), i = this._bindings.length; if (this.memorize && (this._prevParams = e), i) { t = this._bindings.slice(), this._shouldPropagate = !0; do i--; while (t[i] && this._shouldPropagate && t[i].execute(e) !== !1) } } }, forget: function () { this._prevParams = null }, dispose: function () { this.removeAll(), delete this._bindings, delete this._prevParams }, toString: function () { return "[Signal active:" + this.active + " numListeners:" + this.getNumListeners() + "]" } }; var r = n; r.Signal = n, "function" == typeof define && define.amd ? define(function () { return r }) : "undefined" != typeof module && module.exports ? module.exports = r : t.signals = r }(this), function () { var t = function (t) { function e(t, e) { if (t.indexOf) return t.indexOf(e); for (var i = t.length; i--;) if (t[i] === e) return i; return -1 } function i(t, i) { var n = e(t, i); -1 !== n && t.splice(n, 1) } function n(t, e) { return "[object " + e + "]" === Object.prototype.toString.call(t) } function r(t) { return n(t, "RegExp") } function s(t) { return n(t, "Array") } function o(t) { return "function" == typeof t } function a(t) { var e; return e = null === t || "null" === t ? null : "true" === t ? !0 : "false" === t ? !1 : t === f || "undefined" === t ? f : "" === t || isNaN(t) ? t : parseFloat(t) } function u(t) { for (var e = t.length, i = []; e--;) i[e] = a(t[e]); return i } function c(t, e) { for (var i, n, r = (t || "").replace("?", "").split("&"), s = r.length, o = {}; s--;) i = r[s].split("="), n = e ? a(i[1]) : i[1], o[i[0]] = "string" == typeof n ? decodeURIComponent(n) : n; return o } function h() { this.bypassed = new t.Signal, this.routed = new t.Signal, this._routes = [], this._prevRoutes = [], this._piped = [], this.resetState() } function d(e, i, n, s) { var o = r(e), a = s.patternLexer; this._router = s, this._pattern = e, this._paramsIds = o ? null : a.getParamIds(e), this._optionalParamsIds = o ? null : a.getOptionalParamsIds(e), this._matchRegexp = o ? e : a.compilePattern(e, s.ignoreCase), this.matched = new t.Signal, this.switched = new t.Signal, i && this.matched.add(i), this._priority = n || 0 } var l, p, f; return p = "" === /t(.+)?/.exec("t")[1], h.prototype = { greedy: !1, greedyEnabled: !0, ignoreCase: !0, ignoreState: !1, shouldTypecast: !1, normalizeFn: null, resetState: function () { this._prevRoutes.length = 0, this._prevMatchedRequest = null, this._prevBypassedRequest = null }, create: function () { return new h }, addRoute: function (t, e, i) { var n = new d(t, e, i, this); return this._sortedInsert(n), n }, removeRoute: function (t) { i(this._routes, t), t._destroy() }, removeAllRoutes: function () { for (var t = this.getNumRoutes() ; t--;) this._routes[t]._destroy(); this._routes.length = 0 }, parse: function (t, e) { if (t = t || "", e = e || [], this.ignoreState || t !== this._prevMatchedRequest && t !== this._prevBypassedRequest) { var i, n = this._getMatchedRoutes(t), r = 0, s = n.length; if (s) for (this._prevMatchedRequest = t, this._notifyPrevRoutes(n, t), this._prevRoutes = n; s > r;) i = n[r], i.route.matched.dispatch.apply(i.route.matched, e.concat(i.params)), i.isFirst = !r, this.routed.dispatch.apply(this.routed, e.concat([t, i])), r += 1; else this._prevBypassedRequest = t, this.bypassed.dispatch.apply(this.bypassed, e.concat([t])); this._pipeParse(t, e) } }, _notifyPrevRoutes: function (t, e) { for (var i, n = 0; i = this._prevRoutes[n++];) i.route.switched && this._didSwitch(i.route, t) && i.route.switched.dispatch(e) }, _didSwitch: function (t, e) { for (var i, n = 0; i = e[n++];) if (i.route === t) return !1; return !0 }, _pipeParse: function (t, e) { for (var i, n = 0; i = this._piped[n++];) i.parse(t, e) }, getNumRoutes: function () { return this._routes.length }, _sortedInsert: function (t) { var e = this._routes, i = e.length; do --i; while (e[i] && t._priority <= e[i]._priority); e.splice(i + 1, 0, t) }, _getMatchedRoutes: function (t) { for (var e, i = [], n = this._routes, r = n.length; (e = n[--r]) && ((!i.length || this.greedy || e.greedy) && e.match(t) && i.push({ route: e, params: e._getParamsArray(t) }), this.greedyEnabled || !i.length) ;); return i }, pipe: function (t) { this._piped.push(t) }, unpipe: function (t) { i(this._piped, t) }, toString: function () { return "[crossroads numRoutes:" + this.getNumRoutes() + "]" } }, l = new h, l.VERSION = "0.12.0", l.NORM_AS_ARRAY = function (t, e) { return [e.vals_] }, l.NORM_AS_OBJECT = function (t, e) { return [e] }, d.prototype = { greedy: !1, rules: void 0, match: function (t) { return t = t || "", this._matchRegexp.test(t) && this._validateParams(t) }, _validateParams: function (t) { var e, i = this.rules, n = this._getParamsObject(t); for (e in i) if ("normalize_" !== e && i.hasOwnProperty(e) && !this._isValidParam(t, e, n)) return !1; return !0 }, _isValidParam: function (t, i, n) { var a = this.rules[i], u = n[i], c = !1, h = 0 === i.indexOf("?"); return null == u && this._optionalParamsIds && -1 !== e(this._optionalParamsIds, i) ? c = !0 : r(a) ? (h && (u = n[i + "_"]), c = a.test(u)) : s(a) ? (h && (u = n[i + "_"]), c = this._isValidArrayRule(a, u)) : o(a) && (c = a(u, t, n)), c }, _isValidArrayRule: function (t, i) { if (!this._router.ignoreCase) return -1 !== e(t, i); "string" == typeof i && (i = i.toLowerCase()); for (var n, r, s = t.length; s--;) if (n = t[s], r = "string" == typeof n ? n.toLowerCase() : n, r === i) return !0; return !1 }, _getParamsObject: function (t) { for (var i, n, r = this._router.shouldTypecast, s = this._router.patternLexer.getParamValues(t, this._matchRegexp, r), o = {}, u = s.length; u--;) n = s[u], this._paramsIds && (i = this._paramsIds[u], 0 === i.indexOf("?") && n && (o[i + "_"] = n, n = c(n, r), s[u] = n), p && "" === n && -1 !== e(this._optionalParamsIds, i) && (n = void 0, s[u] = n), o[i] = n), o[u] = n; return o.request_ = r ? a(t) : t, o.vals_ = s, o }, _getParamsArray: function (t) { var e, i = this.rules ? this.rules.normalize_ : null; return i = i || this._router.normalizeFn, e = i && o(i) ? i(t, this._getParamsObject(t)) : this._getParamsObject(t).vals_ }, interpolate: function (t) { var e = this._router.patternLexer.interpolate(this._pattern, t); if (!this._validateParams(e)) throw new Error("Generated string doesn't validate against `Route.rules`."); return e }, dispose: function () { this._router.removeRoute(this) }, _destroy: function () { this.matched.dispose(), this.switched.dispose(), this.matched = this.switched = this._pattern = this._matchRegexp = null }, toString: function () { return '[Route pattern:"' + this._pattern + '", numListeners:' + this.matched.getNumListeners() + "]" } }, h.prototype.patternLexer = function () { function t() { var t, e; for (t in p) p.hasOwnProperty(t) && (e = p[t], e.id = "__CR_" + t + "__", e.save = "save" in e ? e.save.replace("{{id}}", e.id) : e.id, e.rRestore = new RegExp(e.id, "g")) } function e(t, e) { var i, n = []; for (t.lastIndex = 0; i = t.exec(e) ;) n.push(i[1]); return n } function i(t) { return e(l, t) } function n(t) { return e(p.OP.rgx, t) } function r(t, e) { return t = t || "", t && (v === f ? t = t.replace(h, "") : v === m && (t = t.replace(d, "")), t = s(t, "rgx", "save"), t = t.replace(c, "\\$&"), t = s(t, "rRestore", "res"), v === f && (t = "\\/?" + t)), v !== g && (t += "\\/?"), new RegExp("^" + t + "$", e ? "i" : "") } function s(t, e, i) { var n, r; for (r in p) p.hasOwnProperty(r) && (n = p[r], t = t.replace(n[e], n[i])); return t } function o(t, e, i) { var n = e.exec(t); return n && (n.shift(), i && (n = u(n))), n } function a(t, e) { if ("string" != typeof t) throw new Error("Route pattern should be a string."); var i = function (t, i) { var n; if (i = "?" === i.substr(0, 1) ? i.substr(1) : i, null != e[i]) { if ("object" == typeof e[i]) { var r = []; for (var s in e[i]) r.push(encodeURI(s + "=" + e[i][s])); n = "?" + r.join("&") } else n = String(e[i]); if (-1 === t.indexOf("*") && -1 !== n.indexOf("/")) throw new Error('Invalid value "' + n + '" for segment "' + t + '".') } else { if (-1 !== t.indexOf("{")) throw new Error("The segment " + t + " is required."); n = "" } return n }; return p.OS.trail || (p.OS.trail = new RegExp("(?:" + p.OS.id + ")+$")), t.replace(p.OS.rgx, p.OS.save).replace(l, i).replace(p.OS.trail, "").replace(p.OS.rRestore, "/") } var c = /[\\.+*?\^$\[\](){}\/'#]/g, h = /^\/|\/$/g, d = /\/$/g, l = /(?:\{|:)([^}:]+)(?:\}|:)/g, p = { OS: { rgx: /([:}]|\w(?=\/))\/?(:|(?:\{\?))/g, save: "$1{{id}}$2", res: "\\/?" }, RS: { rgx: /([:}])\/?(\{)/g, save: "$1{{id}}$2", res: "\\/" }, RQ: { rgx: /\{\?([^}]+)\}/g, res: "\\?([^#]+)" }, OQ: { rgx: /:\?([^:]+):/g, res: "(?:\\?([^#]*))?" }, OR: { rgx: /:([^:]+)\*:/g, res: "(.*)?" }, RR: { rgx: /\{([^}]+)\*\}/g, res: "(.+)" }, RP: { rgx: /\{([^}]+)\}/g, res: "([^\\/?]+)" }, OP: { rgx: /:([^:]+):/g, res: "([^\\/?]+)?/?" } }, f = 1, g = 2, m = 3, v = f; return t(), { strict: function () { v = g }, loose: function () { v = f }, legacy: function () { v = m }, getParamIds: i, getOptionalParamsIds: n, getParamValues: o, compilePattern: r, interpolate: a } }(), l }; "function" == typeof define && define.amd ? define(["signals"], t) : "undefined" != typeof module && module.exports ? module.exports = t(require("signals")) : window.crossroads = t(window.signals) }(), function (t) { t.fn.outerHeight = function () { return t(this).height() + parseInt(t(this).css("margin-top").replace("px", "")) + parseInt(t(this).css("margin-right").replace("px", "")) + parseInt(t(this).css("margin-bottom").replace("px", "")) + parseInt(t(this).css("margin-left").replace("px", "")) }; var e = /hp-tablet/gi.test(navigator.appVersion), i = "ontouchstart" in window && !e; t.fn.globalTapLive = function (t) { i ? this.live("tap", t) : this.live("click", t) }, t.fn.globalTapDie = function (t) { i ? this.die("tap", t) : this.die("click", t) }, t.fn.globalTapOne = function (t) { i ? this.one("tap", t) : this.one("click", t) } }(Zepto || jQuery), function (t) { function e() { return this.crossroads = crossroads || t.crossroads, this.currentRouteName = "", this.currentRoute = "", this.currentRefresh = !1, this.lastRoute = "", this.lastRouteName = "", this.routeType = 0, this.controllers = {}, this.crossroads.bypassed.add(function (t) { console.log(t) }), this } e.prototype.addController = function (t, e) { var i = this; e = e || {}; var n = e.action, r = e.beforeAction, s = this.crossroads.addRoute(e.route, function () { if (0 == i.routeType) { var s = t; i.currentRouteName = s, n.apply(e.action, arguments) } else 1 == i.routeType && "function" == typeof r && r.apply(e.beforeAction, arguments) }); e.rules && (s.rules = e.rules), s.existBeforeAction = "function" == typeof e.beforeAction, s.reset = e.reset, s.resize = e.resize, s.destroy = e.destroy, s.module = e.module, this.controllers[t] = s, "function" == typeof e.init && e.init() }, e.prototype.getRouteNameByRoute = function (t) { t = t.indexOf("#") > -1 ? t.substr(1) : t; for (var e in this.controllers) if (this.controllers[e].match(t)) return e; return "" }, e.prototype.getRouteByParameter = function (t, e) { var i = this.controllers[t]; return i ? i.interpolate(e) : "" }, e.prototype.onRouteChange = function (t) { t = t || !1, t && crossroads.resetState(); var e = this.currentRoute.indexOf("#") > -1 ? this.currentRoute.substr(1) : this.currentRoute; crossroads.parse(e) }, e.prototype.gotoRoute = function (t, e) { this.routeType = 0, this.lastRoute = this.currentRoute, this.lastRouteName = this.currentRouteName; var i = t.toLowerCase(); this.currentRoute = i, this.onRouteChange(e) }, e.prototype.gotoRouteBefore = function (t) { this.routeType = 1; var e = t.toLowerCase(); e = e.indexOf("#") > -1 ? e.substr(1) : e, crossroads.parse(e), crossroads.resetState() }, e.prototype.extend = function (t, e) { for (var i in e) e.hasOwnProperty(i) && (t[i] = e[i]) }; var i = new e; return i.fn = e.prototype, t.mad = i, i }(this), function (e) { e.util = { isNullOrEmpty: function (t) { return null == t || "" === String.prototype.trim.call(t) ? !0 : !1 }, numFormat: function (e, n) { n = n > 0 && 20 >= n ? n : 2, e = parseFloat((e + "").replace(/[^\d\.-]/g, "")).toFixed(n) + ""; var r = e.split(".")[0].split("").reverse(), s = e.split(".")[1]; for (t = "", i = 0; i < r.length; i++) t += r[i] + ((i + 1) % 3 == 0 && i + 1 != r.length ? "," : ""); return t.split("").reverse().join("") + "." + s }, milliFormat: function (t) { if (null == t || "" === t) return ""; var e = t + ""; if ("0" === e) return e; e = e.replace(new RegExp(",", "g"), ""); var i = ""; if (/^([-+]).*$/.test(e) && (i = e.replace(/^([-+]).*$/, "$1"), e = e.replace(/^([-+])(.*)$/, "$2")), /^[0-9]+(\.[0-9]+)?$/.test(e)) { var e = e.replace(new RegExp("^[0]+", "g"), ""); /^\./.test(e) && (e = "0" + e); for (var n = e.replace(/^[0-9]+(\.[0-9]+)?$/, "$1"), r = e.replace(/^([0-9]+)(\.[0-9]+)?$/, "$1"), s = /(\d+)(\d{3})/; s.test(r) ;) r = r.replace(s, "$1,$2"); return i + r + n } return t }, dateFormat: function (t, e) { var i = { "M+": t.getMonth() + 1, "d+": t.getDate(), "H+": t.getHours(), "m+": t.getMinutes(), "s+": t.getSeconds(), "q+": Math.floor((t.getMonth() + 3) / 3), S: t.getMilliseconds() }; /(y+)/.test(e) && (e = e.replace(RegExp.$1, (t.getFullYear() + "").substr(4 - RegExp.$1.length))); for (var n in i) new RegExp("(" + n + ")").test(e) && (e = e.replace(RegExp.$1, 1 == RegExp.$1.length ? i[n] : ("00" + i[n]).substr(("" + i[n]).length))); return e }, setCookie: function (t, e, i) { var n = new Date; "number" == typeof i ? n.setTime(n.getTime() + i) : "[object Date]" == Object.prototype.toString.call(i) && (n = i), document.cookie = t + "=" + escape(e) + ";expires=" + n.toGMTString() }, getCookie: function (t) { var e, i = new RegExp("(^| )" + t + "=([^;]*)(;|$)"); return (e = document.cookie.match(i)) ? e[2] : null }, delCookie: function (t) { var e = new Date; e.setTime(e.getTime() - 1); var i = getCookie(t); null != i && (document.cookie = t + "=" + i + ";expires=" + e.toGMTString()) }, getLocalData: function (t) { var e = ""; return e = window.localStorage ? window.localStorage.getItem(t) : getCookie(t), isNullOrEmpty(e) || "undefined" == e ? "" : e }, setLocalData: function (t) { removeLocalData(t), window.localStorage ? window.localStorage.setItem(t, val) : setCookie(t, val) }, removeLocalData: function (t) { window.localStorage ? window.localStorage.removeItem(t) : delCookie(t) }, round: function (t, e) { for (var i = 1; e > 0; i *= 10, e--); for (; 0 > e; i /= 10, e++); return Math.round(t * i) / i }, charLen: function (t) { for (var e = 0, i = 0; i < t.length; i++) t.charCodeAt(i) > 255 || t.charCodeAt(i) < 0 ? e += 2 : e++; return e }, subCHString: function (t, e, i) { var n = 0, r = ""; t.strToChars(); for (var s = 0; s < t.length; s++) { if (t.charsArray[s][1] ? n += 2 : n++, n > i) return r; n > e && (r += t.charsArray[s][0]) } return r }, decodeUrlParams: function (t) { t = t.split("&"); var e, i = {}; for (var n in t) t.hasOwnProperty(n) && (e = t[n].split("="), 2 == e.length && (i[e[0]] = e[1])); return i } } }(this), function () { var t = { cssPrefixes: ["-webkit-", "-moz-", "-o-", "-ms-", ""] }, e = document.body || document.documentElement, i = e.style; t.transitionEndEvent = "webkitTransitionEnd oTransitionEnd transitionend", void 0 !== i.WebkitTransition ? (t.transitionEndEvent = "webkitTransitionEnd", t.transform = "-webkit-transform", t.transition_duration = "-webkit-transition-duration", t.animation_timing_function = "-webkit-animation-timing-function") : void 0 !== i.MozTransition ? (t.transitionEndEvent = "transitionend", t.transform = "-moz-transform", t.transition_duration = "-moz-transition-duration", t.animation_timing_function = "-moz-animation-timing-function") : void 0 !== i.OTransition ? (t.transitionEndEvent = "oTransitionEnd", t.transform = "-o-transform", t.transition_duration = "-o-transition-duration", t.animation_timing_function = "-o-animation-timing-function") : (t.transitionEndEvent = "transitionend", t.transform = "transform", t.transition_duration = "transition-duration", t.animation_timing_function = "animation-timing-function"), t.cssTransitionsSupported = void 0 !== i.WebkitTransition || void 0 !== i.MozTransition || void 0 !== i.OTransition || void 0 !== i.transition, t.has3D = "WebKitCSSMatrix" in window && "m11" in new WebKitCSSMatrix, mad.constructor.prototype.browserVariables = t }(this), function () { mad.fn.view = {}, mad.view.tempCached = !0, mad.view.templates = {}, mad.view.pages = {}, mad.extend(mad.fn.view, { definePage: function (t, e, i) { this.pages[t] = { url: e, data: i } }, getPage: function (t) { var e = this.pages[t]; return e ? this.render({ cache: !1, url: e.url }, e.data) : null }, addTemp: function (t, e) { this.templates[t] = e }, render: function (t, e) { this.tempCached; t = "string" == typeof t ? { text: t } : t, t.name && (t.text = this.templates[t.name]), t.cache = t.cache || this.tempCached; var i = new EJS(t).render(e); return i }, create: function (t) { this.tempCached; return t = "string" == typeof t ? { text: t } : t, t.name && (t.text = this.templates[t.name]), t.cache = t.cache || this.tempCached, new EJS(t) } }) }(this), function (t) { function e() { return this._values = [], this } function i() { window.scrollTo(0, 1) } function n() { mad.app.isHideBrowserTop && (document.documentElement.style.height = "2000px", i()), o() } function r() { switch (window.orientation) { case 0: case 180: case -90: case 90: n() } } function o() { var t = this; if (t.width = $(window).width(), t.height = $(window).height(), document.documentElement.style.height = t.height + "px", $("#mad-outer").css({ height: t.height }), $(".page").css({ width: t.width, height: t.height }), $(".page").each(function () { var e = t.height - $(this).find("header").height() - $(this).find("footer").height() - $(this).find(".statusbar").height(); $(this).find("section").height(e) }), $(".modal").css({ width: t.width, height: t.height }), $(".modal").each(function () { var e = t.height - $(this).find("header").height() - $(this).find("footer").height() - $(this).find(".statusbar").height(); $(this).find("section").height(e) }), mad.controllers[mad.currentRouteName]) { var e = mad.controllers[mad.currentRouteName]; e && e.resize && e.resize() } } e.prototype.clear = function () { this._values = [] }, e.prototype.count = function () { return this._values.length }, e.prototype.last = function () { return this._values.length > 0 ? this._values[this._values.length - 1] : null }, e.prototype.pop = function (t) { var e = []; for (t = t || 1; t > 0;) this._values.length > 0 && e.push(this._values.pop()), t--; return e }, e.prototype.add = function (t) { return util.isNullOrEmpty(t) ? !1 : (t = t.toString().toLowerCase().trim(), 0 == this._values.length || this._values[this._values.length - 1] != t ? (this._values.push(t), !0) : !1) }, e.prototype.update = function (t, e) { return util.isNullOrEmpty(t) || 0 > e ? !1 : (t = t.toString().toLowerCase().trim(), this._values.length > e ? (this._values[e] = t, !0) : !1) }, e.prototype.item = function (t) { return 0 > t || t > this._values.length - 1 ? null : this._values[t] }, e.prototype.backTo = function (t) { if (!util.isNullOrEmpty(t)) { var e = this.count(); if (e > 1) for (var i = e - 1; i >= 0; i--) if (this.item(i).indexOf(t.toLowerCase()) > -1) return this.pop(e - i), !0; return !1 } }, mad.history = new e, mad.fn.app = {}, mad.app.views = {}, mad.app.transitionsFlag = 0, mad.app.isIos = null, mad.app.isAndroid = null, mad.app.isHideBrowserTop = !0; mad.extend(mad.fn.app, { events: {}, addEvent: function (t, e) { this.events[t] = this.events[t] || [], this.events[t].push(e) }, beforeGotoPage: null, transitions: function (t, e, i, n, r) { var a = mad.browserVariables; e = "#" + e, i = "#" + i; var u = $(window).width(), c = $(window).height(); n = n || 300, s = n / 1e3 + "s"; var h, d = "ease-out"; switch (t) { case "slideLeft": case "slideRight": var l = {}; for (var p in a.cssPrefixes) { var f = a.cssPrefixes[p] + "transform", g = a.cssPrefixes[p] + "transition-duration"; l[f] = "none", l[g] = "0s" } $(i).css(l), $(e).css(l), $(i).css({ top: 0, left: 0, width: u, height: c, opacity: 1 }), $(e).css({ display: "block", top: 0, left: "slideLeft" == t ? u : -u, width: u, height: c, opacity: 1 }), o(), h = "slideLeft" == t ? "translate3d(-" + u + "px,0px,0px)" : "translate3d(" + u + "px,0px,0px)"; var l = {}; for (var p in a.cssPrefixes) { var f = a.cssPrefixes[p] + "transform", g = a.cssPrefixes[p] + "transition-duration", m = a.cssPrefixes[p] + "animation-timing-function"; l[f] = h, l[g] = s, l[m] = d } var v = function () { var t = $(i), n = $(e), s = {}; for (var o in a.cssPrefixes) { var u = a.cssPrefixes[o] + "transition-duration"; s[u] = "0s" } t.hide(), t.css(s), n.css(s), "function" == typeof r && r() }, _ = setTimeout(function () { var t = l, n = $(i), r = $(e); n.css(t), r.css(t), clearTimeout(_) }, 0); $(e).one(a.transitionEndEvent, function () { v() }); break; case "fade": var y = { left: 0, top: 0 }; for (var p in a.cssPrefixes) { var f = a.cssPrefixes[p] + "transform", g = a.cssPrefixes[p] + "transition-duration"; y[f] = "translate3d(0px,0px,0px)", y[g] = "0s" } $(e).css(y), $(i).css(y), $(i).animate({ opacity: 0 }, 200, d, function () { $(i).hide() }), $(e).css("opacity", "0").show(), $(e).animate({ opacity: 1 }, 200, d, function () { "undefined" != typeof r && r() }), o(); break; case "none": default: $(i).css({ left: 0, top: 0, opacity: 1 }), $(e).css({ left: 0, top: 0, opacity: 1 }); var y = {}; for (var p in a.cssPrefixes) { var f = a.cssPrefixes[p] + "transform", g = a.cssPrefixes[p] + "transition-duration"; y[f] = "translate3d(0px,0px,0px)", y[g] = "0s" } $(e).css(y), $(i).css(y), $(i).hide(), $(e).show(), o(), "function" == typeof r && r() } }, back: function (t, e, i) { var n = this, r = mad.history.last(); mad.history.pop(), n.gotoPage(r, t, e, i, !0) }, gotoPage: function (t, e, i, n, r) { var s = this; if (!util.isNullOrEmpty(t) && 0 == s.transitionsFlag) { s.transitionsFlag = 2; var o = mad.currentRouteName, t = t, a = mad.getRouteNameByRoute(t); if ("" == a || "block" == $("#" + a).css("display")) return void (s.transitionsFlag = 0); if (s.initPage(a), s.events.onBeforeGotoPage) for (var u = s.events.onBeforeGotoPage, c = 0; c < u.length; c++) u[c](o, a); i = null != i && "true" == i.toString() ? !0 : !1, r = null != r && "true" == r.toString() ? !0 : !1, !r && mad.currentRoute && mad.history.add(mad.currentRoute), 1 == i && "function" == typeof mad.controllers[a].reset && mad.controllers[a].reset(); var h = function () { "" !== o && "function" == typeof mad.controllers[o].destroy && mad.controllers[o].destroy(), mad.gotoRoute(t.trim()), s.transitionsFlag = 0, "function" == typeof n && n() }; mad.controllers[a].existBeforeAction && mad.gotoRouteBefore(t.trim()), s.transitions(e, a, o, null, h) } }, initPage: function (t) { var e = this, i = $("#" + t); if (0 == i.length && mad.view && mad.view.getPage) { e.showLoading && e.showLoading(), i = mad.view.getPage(t), i = $(i), i.attr("id", t), i.attr("data-role", "page"), i.addClass("page"), i.css("display", "none"); var n = $("#container"); n.append(i), e.hideLoading && e.hideLoading() } }, initApp: function () { var t = $("#mad-outer"); if (0 == t.length) { var e = $("div"); e.attr("id", "mad-outer"), $container = $("div"), $container.attr("id", "container"), $container.addClass("clearfixed"), e.append($container), $("body").children().remove(), $("body").append(e) } }, ready: function (e) { var i = this; "object" == typeof e && (mad.app.isIos = e.isIos, mad.app.isAndroid = e.isAndroid), mad.app.isIos = mad.app.isIos || /iPhone|iPad|iPod|iOS/i.test(t.navigator.userAgent), mad.app.isAndroid = mad.app.isAndroid || /Android/i.test(t.navigator.userAgent), document.addEventListener("touchmove", function (t) { t.preventDefault() }, !1), mad.app.isIos ? window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", r, !1) : $(window).resize(function () { n() }), i.width = $(window).width(), i.height = $(window).height(), i.initApp(), $("#mad-outer").css("height", this.height), $("[data-role]").each(function () { var t = $(this).attr("data-role"); !util.isNullOrEmpty(t) && /(page)|(modal)/.test(t) && ($(this).css({ width: i.width + "px", height: i.height + "px", display: "none" }), $(this).addClass(t), i.views[$(this).attr("id")] = { role: t }, $(this).find("[data-role='scrollerSection']").addClass("scrollerSection"), i.statusbar && $(this).prepend('<div class="statusbar"></div>')) }), $("[data-forhash]").globalTapLive(function () { var t = $(this).attr("data-forhash"), e = $(this).attr("data-transition"), n = $(this).attr("data-reset"), r = $(this).attr("data-back"); return "true" == r ? i.back(e, n, null) : i.gotoPage(t, e, n, null), !1 }) } }) }(this);;